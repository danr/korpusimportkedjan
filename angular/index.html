<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<html ng-app="formModule">
  <head>
    <script type="text/javascript" src="lib/underscore.js"></script>
    <script type="text/javascript" src="lib/angular.js"></script>
    <script type="text/javascript" src="index.js"></script>
  </head>
  <body>
    <!-- takes prop, desc -->
    <script type="text/ng-template" id="form_item">
      <div>
        {{desc.title}}
		<!--
<pre>values[prop]: {{values[prop]}}
prop: {{prop}}
desc: {{desc}}</pre>
-->
        <div ng-switch on="desc.type">

          <input ng-switch-when="bool" ng-model="values[prop]" type="checkbox">

          <div ng-switch-when="string">
            <!-- not an enum -->
            <span ng-repeat="e in desc.enum">
              <input type="radio" ng-model="values[prop]" value="{{e}}">
              <label>{{e}}</label>
            </span>
            <input ng-show="!desc.enum" ng-model="values[prop]">
          </div>

		  <div ng-switch-when="object">
			<ul ng-repeat="values in [values[prop]]">
			  <li ng-repeat="(prop, desc) in desc.properties" ng-include="'form_item'"></li>
			</ul>
		  </div>

          <div ng-switch-when="array">
            <ul>
			  <!--
				  desc must be replaced with the description of elements,
				  values with the array,
				  prop with the index in the array
			   -->
              <button ng-click="values[prop].unshift(clone(desc.items.default))">ny</button>
              <span ng-repeat="desc in [desc.items]">
                <span ng-repeat="values in [values[prop]]">
                  <li ng-repeat="elt in values">
                    <div ng-repeat="prop in [$index]" ng-include="'form_item'"></div>
                  </li>
                </span>
              </span>
            </ul>
          </div>

          <!-- assume union type -->
          <div ng-switch-default>
            <select ng-model="values['_' + prop]"
                    ng-options="t.title for t in desc.type"
                    ng-change="values[prop] = clone(values['_' + prop]['default'])">
            </select>
            <pre>values['_' + prop]: {{values['_' + prop]}}</pre>
            <div ng-repeat="desc in [values['_' + prop]]" ng-include="'form_item'">
            </div>
          </div>

        </div>
      </div>
    </script>

    <div ng-controller="FormCtrl">
      <pre>values: {{values | json}}</pre>
      <form>
        <ul>
          <li ng-repeat="(prop,desc) in schema" ng-include="'form_item'"></li>
        </ul>
      </form>
    </div>
  </body>
</html>
